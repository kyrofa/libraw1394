#!/usr/bin/make -f

#export DH_VERBOSE=1
export DH_COMPAT=1


majorname	= $(shell grep library_names src/libraw1394.la | cut -d"'" -f 2 | cut -d" " -f 2)
fullversionname	= $(shell grep library_names src/libraw1394.la | cut -d"'" -f 2 | cut -d" " -f 1)
major 		= $(shell echo $(majorname) | cut -d"." -f 3)


autoclean-files:
	echo $@ >$@

build: build-stamp
build-stamp:
	dh_testdir

	./configure --prefix=/usr --mandir=\$${prefix}/share/man --infodir=\$${prefix}/share/info
	$(MAKE)

	touch build-stamp

clean: autoclean-files
	dh_testdir
	dh_testroot
	rm -f build-stamp

	-$(MAKE) distclean

	dh_clean
	xargs <autoclean_files rm -f

install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs

	$(MAKE) install prefix=`pwd`/debian/tmp/usr

binary-indep: build install
# Nothing to do here

binary-arch: build install autoclean-files
	dh_testdir
	dh_testroot

	dh_movefiles -plibraw1394-$(major)	\
		usr/lib/$(majorname)		\
		usr/lib/$(fullversionname)

	echo debian/libraw1394-$(major).postinst >>autoclean_files
	sed <debian/libraw1394.postinst.in >debian/libraw1394-$(major).postinst \
		-e s/@libname@/$(fullversionname)/

	dh_installdocs
	dh_installchangelogs
	dh_strip
	dh_compress
	dh_fixperms
	dh_makeshlibs
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install
